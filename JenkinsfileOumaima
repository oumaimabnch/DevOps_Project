pipeline {
  agent any 
   

  stages {
    
    stage('git checkout') {
      steps {
        sh 'git reset --hard origin/main'
        git branch : 'main',
        url: 'https://github.com/oumaimabnch/DevOps_Project',
        credentialsId: '2de83c68-381f-4cf6-b742-eb0cb37e3637';
        echo 'checkout stage one '
           }
  }  

    
    
  
     stage ('MNV BUILD') {
      steps {
         echo 'before Build stage done'
        sh 'mvn clean package'
        echo 'after Build stage done'
      }
    }
    
    
       stage ('MVN COMPILE') {
      steps {
        sh 'mvn compile'
        echo 'compile stage done'

      }
    }
  
    
    stage ('JUNIT+MOCK') {
      steps {
        sh 'mvn test'
      }
    }
    
    
    stage ('STATIC TEST WITH SONAR') {
       steps {
       withSonarQubeEnv('sq') { 
                sh 'mvn sonar:sonar'
        }
      }
    }
  
  stage ('NEXUS DEPLOY') {
       steps {
       sh 'mvn deploy -DskipTests'
        
      }
    }
  
    
    
    
    
    
    
    
  
 }
}
